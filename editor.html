<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<div id="editor" contentEditable="true" style="width:400px; height: 200px; border: #ccc 1px solid; margin: 50px auto;"></div>
<ul style="font-size: 16px; line-height: 24px;">
<li id="bold">粗</li>
<li id="color">红</li>
<li id="bg">蓝</li>
<li id="italic">斜</li>
<li id="underline">线</li>
<li id="size">大</li>
<li id="height">高</li>
<li id="align">对齐</li>
</ul>
<div id="outbtn">输出</div>
<div id="returncolor" ></div>
<div id="output" style="width: 600px; height: 200px; border: #ccc 1px solid; margin: 30px auto;">
	
</div>

<script type="text/javascript" >
	var setBold = document.getElementById('bold');
    var setColor = document.getElementById('color');
    var setBg = document.getElementById('bg');
    var setItalic = document.getElementById('italic');
    var setUnderline = document.getElementById('underline');
    var setSize = document.getElementById('size');
    var setHeight = document.getElementById('height');
    var setAlign = document.getElementById('align');
    //
    var outbtn = document.getElementById('outbtn');
//
    var RE = {}; 
    RE.editor = document.getElementById('editor');

    RE.checkTag = function(tag){
        //var h = RE.editor.innerHTML;
        // var re;
        // if(tag =='b'){
        //  //re = /<b>/i
        //  re = /<\/?b[^>]*>/gi
        // }else if(tag == 'i'){
        //  re = /<\/?i[^>]*>/gi
        // }else if(tag == 'u'){
        //  re = /<\/?u[^>]*>/gi
        // }
        // return re.test(h)
        if(RE.editor.getElementsByTagName(tag).length){
            return true
        }else{
            return false
        }
    }
    RE.deleteTag = function(tag){
        var tmpH, re, newH;
        if(RE.checkTag('div')){
            tmpH = RE.editor.getElementsByTagName('div')[0].innerHTML;
        }else{
            tmpH = RE.editor.innerHTML
        }

        if(tag =='b'){
            re = /<\/?b[^>]*>/gi;
            newH = tmpH.replace(re, "")
        }else if(tag == 'i'){
            re = /<\/?i[^>]*>/gi;
            newH = tmpH.replace(re, "")
        }else if(tag == 'u'){
            re = /<\/?u[^>]*>/gi;
            newH = tmpH.replace(re, "")
        }
        RE.setHtml(newH)
    }

    RE.getColor = function(){
        if(RE.checkTag('font')){
            if(RE.editor.getElementsByTagName('font')[0].color ==''){
                return "默认"
            }else{
                return RE.editor.getElementsByTagName('font')[0].color
            }
        }else{
            return "默认"
        }
    }
    RE.getBg = function(){
        if(RE.checkTag('font')){
            if(RE.editor.getElementsByTagName('font')[0].style.backgroundColor == ''){
                return "默认"
            }else{
                return RE.editor.getElementsByTagName('font')[0].style.backgroundColor
            }
        }else{
            return "默认"
        }
    }
    RE.setHtml = function(contents) {
        if(RE.checkTag('div')){
            RE.editor.getElementsByTagName('div')[0].innerHTML = decodeURIComponent(contents.replace(/\+/g, '%20'));
        }else{
            RE.editor.innerHTML  = decodeURIComponent(contents.replace(/\+/g, '%20'));
        }
    }

    RE.getHtml = function() {
        if(RE.checkTag('div')){
            return RE.editor.getElementsByTagName('div')[0].innerHTML
        }else{
            return RE.editor.innerHTML;
        }
        
    }

    RE.getText = function() {
        return RE.editor.innerText;
    }
    RE.isEmpty = function(){
        if (RE.getText().length <1){
            return true
        }else{
            return false
        }
    }
    setBold.onclick = function(){
        console.log(2);
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('b')){
            RE.deleteTag('b')
        }else{
            RE.setHtml('<b>' + RE.getHtml() + '</b>' )
        }
    }
    //testing
    var textcolor = '#ff0000';
    setColor.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('font')){
            RE.editor.getElementsByTagName('font')[0].color = textcolor
        }else{
            RE.setHtml('<font' + ' color="' + textcolor + '">' + RE.getHtml() + '</font>' )
        }
    }
    //testing
    var bgcolor = 'rgba(0,255,0,1)'
    setBg.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('font')){
            RE.editor.getElementsByTagName('font')[0].style.backgroundColor = bgcolor
        }else{
            RE.setHtml('<font' + ' style="background-color:' + bgcolor + '">' + RE.getHtml() + '</font>' )
        }
    }
    setItalic.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('i')){
            RE.deleteTag('i')
        }else{
            RE.setHtml('<i>' + RE.getHtml() + '</i>' )
        }
    }
    setUnderline.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('u')){
            RE.deleteTag('u')
        }else{
            RE.setHtml('<u>' + RE.getHtml() + '</u>' )
        }
    }
    //testing
    var textsize = 16
    //
    setSize.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('font')){
            RE.editor.getElementsByTagName('font')[0].size = textsize
        }else{
            RE.setHtml('<font' + ' size="' + textsize + '">' + RE.getHtml() + '</font>' )
        }
    }
    //testing
    var lineHeight = 3;
    //
    setHeight.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('div')){
            RE.editor.getElementsByTagName('div')[0].style.lineHeight = lineHeight;
        }else{
            RE.setHtml('<div' + ' style="line-height:' + lineHeight + '">' + RE.getHtml() + '</div>' )
        }
    }
    //testing
    var textalign ="right";
    //
    setAlign.onclick = function(){
        if(RE.isEmpty()){
            return
        }else if(RE.checkTag('div')){
            RE.editor.getElementsByTagName('div')[0].style.textAlign = textalign;
        }else{
            RE.setHtml('<div' + ' style="text-align:' + textalign + '">' + RE.getHtml() + '</div>' )
        }
    }

    //
    outbtn.onclick = function(){

        var outwrap = document.getElementById('output');
        var returncolor = document.getElementById('returncolor');
        outwrap.innerText = RE.editor.innerHTML;
        returncolor.innerText = "文字颜色是:" + RE.getColor()  + "___________背景颜色是:"  + RE.getBg();
    }
</script>

</body>
</html>